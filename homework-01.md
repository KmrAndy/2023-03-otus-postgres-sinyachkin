# Домашнее задание
## Работа с уровнями изоляции транзакции в PostgreSQL

### Цель:
- научиться работать с Google Cloud Platform на уровне Google Compute Engine (IaaS)
- научиться управлять уровнем изолции транзации в PostgreSQL и понимать особенность работы уровней read commited и repeatable read

### Описание/Пошаговая инструкция выполнения домашнего задания:
1) создать новый проект в Google Cloud Platform, Яндекс облако или на любых ВМ, докере
2) далее создать инстанс виртуальной машины с дефолтными параметрами
3) добавить свой ssh ключ в metadata ВМ
4) зайти удаленным ssh (первая сессия), не забывайте про ssh-add
5) поставить PostgreSQL
6) зайти вторым ssh (вторая сессия)
7) запустить везде psql из под пользователя postgres
8) **выключить auto commit**
9) сделать в первой сессии новую таблицу и наполнить ее данными
```sql
create table persons(id serial, first_name text, second_name text);
insert into persons(first_name, second_name) values('ivan', 'ivanov');
insert into persons(first_name, second_name) values('petr', 'petrov');
commit;
```
10) посмотреть текущий уровень изоляции: show transaction isolation level - _read committed_
11) начать новую транзакцию в обоих сессиях с дефолтным (не меняя) уровнем изоляции
12) в первой сессии добавить новую запись
```sql
insert into persons(first_name, second_name) values('sergey', 'sergeev');
```
13) сделать во второй сессии
```sql
select * from persons;
```
14) **видите ли вы новую запись и если да то почему?** - _Не вижу, так как уровень изоляции read committed. В нашем случае первая сессия пока ещё не закоммитила транзакцию, поэтому вторая сессия не видит новые записи_
15) завершить первую транзакцию ```commit;```
16) сделать во второй сессии
```sql
select * from persons;
```
17) **видите ли вы новую запись и если да то почему?** - _Вижу, так как теперь новая запись закоммичена._
18) завершите транзакцию во второй сессии
19) начать новые но уже repeatable read транзации
```sql
set transaction isolation level repeatable read;
```
20) в первой сессии добавить новую запись
```sql
insert into persons(first_name, second_name) values('sveta', 'svetova');
```
21) сделать во второй сессии
```sql
select * from persons;
```
22) **видите ли вы новую запись и если да то почему?** - _Не вижу, в repeatable read видим данные на момент начала первого оператора в транзакции, а не любого оператора._
23) завершить первую транзакцию ```commit;```
24) сделать во второй сессии
```sql
select * from persons;
```
25) **видите ли вы новую запись и если да то почему?** - _Не вижу, так как вторая сессия ещё не завершилсь и она будет видеть только данные с момента первого SELECT._
26) завершить вторую транзакцию
27) сделать во второй сессии
```sql
select * from persons;
```
28) **видите ли вы новую запись и если да то почему?** - _Вижу, так как repeatable read транзакция завершилась_